<% is_admin = @user.try(:is_admin?) %>
<p>
  You can <a href="/filters">filter out stories by tag</a>, even if you don't have an account.
  Inactive tags can no longer be used on new stories.
</p>

<% @categories.each do |category| %>
  <div class="tag-title">
    <h2 id="<%= category.category %>">
      <%= link_to category.category, category_path(category) %>
    </h2>
    <% if is_admin %>
      <p class="byline"><%= divider_tag %> <%= link_to 'edit', edit_category_path(category.category), id: "editlink-#{category.category}", aria: {labelledby: "editlink-#{category.category} #{category.category}"} %></p>
      <% end %>
  </div>

  <ol class="category_tags" aria-labelledby="<%= category.category %>">
    <% category.tags.each do |tag| %>
      <li>
        <% filtered = @filtered_tags.include?(tag.id) %>
        <%= tag_link tag, {id: tag.tag} %>
        <span class="<%= filtered || !tag.active ? 'inactive_tag' : '' %>"><%= tag.description %></span>
        <span class="byline">
          <% if !tag.active %>
            <%= divider_tag %> <em>inactive</em>
          <% end %>
          <% if filtered %>
            <%= divider_tag %> <%= link_to "filtered", filters_path(anchor: tag.tag) %>
          <% end %>
          <% if is_admin %>
            <%= divider_tag %> <%= link_to 'edit', edit_mod_tag_path(tag.tag), id: "editlink-#{tag.tag}", aria: {labelledby: "editlink-#{tag.tag} tag-#{tag.tag}"} %>
          <% end %>
        </span>
      </li>
    <% end %>
  </ol>
<% end %>

<% if is_admin %>
  <p>
    <%= link_to 'Create New Tag', new_mod_tag_path %><br/>
    <%= link_to 'Create New Category', new_category_path %>
  </p>
<% end %>
